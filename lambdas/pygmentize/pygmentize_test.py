import pygmentize
import unittest

test_link_1 = {
  'link': 'https://github.com/dminnear/gitshame/blob/eaec1d16cdd4b5178baeeac2fba9e8b718642ab4/lambdas/post_comment/post_comment.py#L6-L20',
  'sha': '303aa335666d95873e27902507a3f44cd603f88a',
  'html': '<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">local</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;IS_LOCAL&#39;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>\n<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="s1">&#39;http://localhost:8001&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">local</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="k">else</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">)</span>\n\n<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>\n  <span class="n">post_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>\n  <span class="n">sha</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;sha&#39;</span><span class="p">]</span>\n  <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>\n  <span class="n">post</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">]</span>\n\n  <span class="n">client</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>\n    <span class="n">TableName</span><span class="o">=</span><span class="s1">&#39;gitshame-posts&#39;</span><span class="p">,</span>\n    <span class="n">Item</span><span class="o">=</span><span class="p">{</span>\n      <span class="s1">&#39;post_id&#39;</span><span class="p">:</span> <span class="p">{</span>\n        <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">post_id</span>\n      <span class="p">},</span>\n</pre></div>\n</td></tr></table>',
  'json' : '{"name": "post_comment.py", "encoding": "base64", "url": "https://api.github.com/repos/dminnear/gitshame/contents/lambdas/post_comment/post_comment.py?ref=eaec1d16cdd4b5178baeeac2fba9e8b718642ab4", "html_url": "https://github.com/dminnear/gitshame/blob/eaec1d16cdd4b5178baeeac2fba9e8b718642ab4/lambdas/post_comment/post_comment.py", "download_url": "https://raw.githubusercontent.com/dminnear/gitshame/eaec1d16cdd4b5178baeeac2fba9e8b718642ab4/lambdas/post_comment/post_comment.py", "content": "aW1wb3J0IGJvdG8zCmltcG9ydCBvcwppbXBvcnQgdGltZQppbXBvcnQgdXVp\\nZAoKbG9jYWwgPSBvcy5nZXRlbnYoJ0lTX0xPQ0FMJywgImZhbHNlIikKY2xp\\nZW50ID0gYm90bzMuY2xpZW50KCdkeW5hbW9kYicsIGVuZHBvaW50X3VybD0n\\naHR0cDovL2xvY2FsaG9zdDo4MDAxJywgcmVnaW9uX25hbWU9J3VzLWVhc3Qt\\nMScpIGlmIGxvY2FsID09ICJ0cnVlIiBlbHNlIGJvdG8zLmNsaWVudCgnZHlu\\nYW1vZGInKQoKZGVmIGhhbmRsZXIoZXZlbnQsIGNvbnRleHQpOgogIHBvc3Rf\\naWQgPSBzdHIodXVpZC51dWlkNCgpKQogIHNoYSA9IGV2ZW50WydzaGEnXQog\\nIHRpbWVzdGFtcCA9IHN0cih0aW1lLnRpbWUoKSAqIDEwMDApCiAgcG9zdCA9\\nIGV2ZW50Wydwb3N0J10KCiAgY2xpZW50LnB1dF9pdGVtKAogICAgVGFibGVO\\nYW1lPSdnaXRzaGFtZS1wb3N0cycsCiAgICBJdGVtPXsKICAgICAgJ3Bvc3Rf\\naWQnOiB7CiAgICAgICAgJ1MnOiBwb3N0X2lkCiAgICAgIH0sCiAgICAgICdz\\naGEnOiB7CiAgICAgICAgJ1MnOiBzaGEKICAgICAgfSwKICAgICAgJ3RpbWVz\\ndGFtcCc6IHsKICAgICAgICAnUyc6IHRpbWVzdGFtcAogICAgICB9LAogICAg\\nICAncG9zdCc6IHsKICAgICAgICAnUyc6IHBvc3QKICAgICAgfQogICAgfSkK\\nCiAgcmV0dXJuIChwb3N0X2lkLCBzaGEsIHRpbWVzdGFtcCwgcG9zdCkK\\n", "sha": "303aa335666d95873e27902507a3f44cd603f88a", "_links": {"self": "https://api.github.com/repos/dminnear/gitshame/contents/lambdas/post_comment/post_comment.py?ref=eaec1d16cdd4b5178baeeac2fba9e8b718642ab4", "git": "https://api.github.com/repos/dminnear/gitshame/git/blobs/303aa335666d95873e27902507a3f44cd603f88a", "html": "https://github.com/dminnear/gitshame/blob/eaec1d16cdd4b5178baeeac2fba9e8b718642ab4/lambdas/post_comment/post_comment.py"}, "git_url": "https://api.github.com/repos/dminnear/gitshame/git/blobs/303aa335666d95873e27902507a3f44cd603f88a", "path": "lambdas/post_comment/post_comment.py", "type": "file", "size": 672}'
}

test_link_2 = {
  'link': 'https://github.com/dminnear/gitshame/blob/ca25824abb09c1e709daecdbc23f559b261acdb6/lambdas/index_html/index_html_test.py#L82',
  'sha': 'e9ee37bc9174fef1e16773bee135577de83e5b18',
  'html': '<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>82</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>\n</pre></div>\n</td></tr></table>',
  'json': '{"name": "index_html_test.py", "encoding": "base64", "url": "https://api.github.com/repos/dminnear/gitshame/contents/lambdas/index_html/index_html_test.py?ref=ca25824abb09c1e709daecdbc23f559b261acdb6", "html_url": "https://github.com/dminnear/gitshame/blob/ca25824abb09c1e709daecdbc23f559b261acdb6/lambdas/index_html/index_html_test.py", "download_url": "https://raw.githubusercontent.com/dminnear/gitshame/ca25824abb09c1e709daecdbc23f559b261acdb6/lambdas/index_html/index_html_test.py", "content": "aW1wb3J0IGluZGV4X2h0bWwKaW1wb3J0IHVuaXR0ZXN0CgpleHBlY3RlZCA9\\nICIiIgo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4tdXMiPgo8dGl0\\nbGU+R2l0c2hhbWU8L3RpdGxlPgo8bWV0YSBjaGFyc2V0PVVURi04IiAvPgo8\\nbGluayBocmVmPSIvL3MzLmFtYXpvbmF3cy5jb20vZ2l0c2hhbWUtaHRtbC9t\\nYWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyI+Cjxs\\naW5rIGhyZWY9Ii8vczMuYW1hem9uYXdzLmNvbS9naXRzaGFtZS1odG1sL2lj\\nb24ucG5nIiByZWw9Imljb24iIHR5cGU9ImltYWdlL3BuZyI+CjxzY3JpcHQg\\nc3JjPSIvL3MzLmFtYXpvbmF3cy5jb20vZ2l0c2hhbWUtaHRtbC9tYWluLmpz\\nIj48L3NjcmlwdD4KCjxib2R5PgogIDxkaXYgY2xhc3M9Im5hdiI+CiAgICA8\\naDEgY2xhc3M9InRpdGxlIj4gR2l0c2hhbWUgPC9oMT4KICAgIDxidXR0b24g\\ndHlwZT0iYnV0dG9uIiBjbGFzcz0ic2hhbWUgZ3Jvb3ZlIiBvbmNsaWNrPSJv\\ncGVuTW9kYWwoKSI+IFNoYW1lISA8L2J1dHRvbj4KICA8L2Rpdj4KICA8ZGl2\\nIGlkPSJtb2RhbCIgb25jbGljaz0iY2xvc2VNb2RhbEV2ZW50KGV2ZW50KSI+\\nCiAgICA8ZGl2IGNsYXNzPSJncm9vdmUiPgogICAgICA8aDM+IEVudGVyIGEg\\nc2hhbWVmdWwgZ2l0aHViIGxpbmsgPC9oMz4KICAgICAgPGlucHV0IGlkPSJs\\naW5rIiB0eXBlPSJ0ZXh0IiBuYW1lPSJsaW5rIj4KICAgICAgPGlucHV0IHR5\\ncGU9ImJ1dHRvbiIgdmFsdWU9IlNoYW1lISIgb25jbGljaz0ic2hhbWUoKSI+\\nCiAgICA8L2Rpdj4KICA8L2Rpdj4KCjxkaXYgY2xhc3M9J3dyYXBwZXIgZ3Jv\\nb3ZlJz48ZGl2IGNsYXNzPSdmaWxlLWhlYWRlcic+PGEgaHJlZj0nL2Jsb2Iv\\nNDQwMWE0OTIzMjc5MTc2MjNhMzFkNDgwYTllYWUyMWEzMWEwODllYyc+NDA0\\nLmphZGU8L2E+PC9kaXY+PGRpdiBjbGFzcz0nc2Nyb2xsJz48dGFibGUgY2xh\\nc3M9ImhpZ2hsaWdodHRhYmxlIj48dHI+PHRkIGNsYXNzPSJsaW5lbm9zIj48\\nZGl2IGNsYXNzPSJsaW5lbm9kaXYiPjxwcmU+MQoyPC9wcmU+PC9kaXY+PC90\\nZD48dGQgY2xhc3M9ImNvZGUiPjxkaXYgY2xhc3M9ImhpZ2hsaWdodCI+PHBy\\nZT48c3Bhbj48L3NwYW4+PHNwYW4gY2xhc3M9Im50Ij5oMTwvc3Bhbj4gNDA0\\nCjxzcGFuIGNsYXNzPSJudCI+cDwvc3Bhbj4gUGFnZSBub3QgZm91bmQuIEJ1\\nbW1lci4KPC9wcmU+PC9kaXY+CjwvdGQ+PC90cj48L3RhYmxlPjwvZGl2Pjwv\\nZGl2Pgo8ZGl2IGNsYXNzPSd3cmFwcGVyIGdyb292ZSc+PGRpdiBjbGFzcz0n\\nZmlsZS1oZWFkZXInPjxhIGhyZWY9Jy9ibG9iLzgwN2Y1NDM3YTlmZTIyMWE2\\nYjc5ZDk2NjE5YjQxYzY3YmUxNGM0ZjQnPmFjdGl2YXRlLnNoPC9hPjwvZGl2\\nPjxkaXYgY2xhc3M9J3Njcm9sbCc+PHRhYmxlIGNsYXNzPSJoaWdobGlnaHR0\\nYWJsZSI+PHRyPjx0ZCBjbGFzcz0ibGluZW5vcyI+PGRpdiBjbGFzcz0ibGlu\\nZW5vZGl2Ij48cHJlPiAxCiAyCiAzCiA0CiA1CiA2CiA3CiA4CiA5CjEwCjEx\\nCjEyCjEzCjE0CjE1CjE2CjE3CjE4CjE5CjIwCjIxCjIyCjIzPC9wcmU+PC9k\\naXY+PC90ZD48dGQgY2xhc3M9ImNvZGUiPjxkaXYgY2xhc3M9ImhpZ2hsaWdo\\ndCI+PHByZT48c3Bhbj48L3NwYW4+PHNwYW4gY2xhc3M9ImNoIj4jIS91c3Iv\\nYmluL2VudiBiYXNoPC9zcGFuPgoKPHNwYW4gY2xhc3M9ImMxIj4jIFRoaXMg\\naXMgdGhlIGFjdGl2YXRpb24gc2NyaXB0IGZvciB0aGUgImNvZGUgaG9zdGlu\\nZyIgZHJpdmVyIGZhbWlseS48L3NwYW4+CjxzcGFuIGNsYXNzPSJjMSI+Izwv\\nc3Bhbj4KPHNwYW4gY2xhc3M9ImMxIj4jIEl0IGlzIGNhbGxlZCB3aGVuIHRo\\naXMgZmFtaWx5IGlzIGFjdGl2YXRlZC48L3NwYW4+CjxzcGFuIGNsYXNzPSJj\\nMSI+IyBJdCBhdXRvbWF0aWNhbGx5IGRldGVybWluZXMgdGhlIHJpZ2h0IGRy\\naXZlciBmb3IgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQ8L3NwYW4+CjxzcGFu\\nIGNsYXNzPSJjMSI+IyBhbmQgbG9hZHMgaXQuPC9zcGFuPgoKCjxzcGFuIGNs\\nYXNzPSJjMSI+IyBMb2FkcyB0aGUgY29kZS1ob3N0aW5nIGRyaXZlciB0aGF0\\nIHdvcmtzIHdpdGggdGhlIGdpdmVuIGhvc3RuYW1lPC9zcGFuPgo8c3BhbiBj\\nbGFzcz0iayI+ZnVuY3Rpb248L3NwYW4+IGFjdGl2YXRlX2RyaXZlcl9mb3Jf\\nY29kZV9ob3N0aW5nIDxzcGFuIGNsYXNzPSJvIj57PC9zcGFuPgogIDxzcGFu\\nIGNsYXNzPSJuYiI+bG9jYWw8L3NwYW4+IDxzcGFuIGNsYXNzPSJudiI+b3Jp\\nZ2luX2hvc3RuYW1lPC9zcGFuPjxzcGFuIGNsYXNzPSJvIj49PC9zcGFuPjxz\\ncGFuIGNsYXNzPSJzMiI+Ijwvc3Bhbj48c3BhbiBjbGFzcz0iayI+JCg8L3Nw\\nYW4+cmVtb3RlX2RvbWFpbjxzcGFuIGNsYXNzPSJrIj4pPC9zcGFuPjxzcGFu\\nIGNsYXNzPSJzMiI+Ijwvc3Bhbj4KICA8c3BhbiBjbGFzcz0iayI+aWY8L3Nw\\nYW4+IDxzcGFuIGNsYXNzPSJvIj5bPC9zcGFuPiA8c3BhbiBjbGFzcz0iczIi\\nPiI8L3NwYW4+PHNwYW4gY2xhc3M9Im52Ij4kb3JpZ2luX2hvc3RuYW1lPC9z\\ncGFuPjxzcGFuIGNsYXNzPSJzMiI+Ijwvc3Bhbj4gPHNwYW4gY2xhc3M9Im8i\\nPj09PC9zcGFuPiA8c3BhbiBjbGFzcz0iczEiPidnaXRodWIuY29tJzwvc3Bh\\nbj4gPHNwYW4gY2xhc3M9Im8iPl08L3NwYW4+PHNwYW4gY2xhc3M9InAiPjs8\\nL3NwYW4+IDxzcGFuIGNsYXNzPSJrIj50aGVuPC9zcGFuPgogICAgYWN0aXZh\\ndGVfZHJpdmVyIDxzcGFuIGNsYXNzPSJzMSI+J2NvZGVfaG9zdGluZyc8L3Nw\\nYW4+IDxzcGFuIGNsYXNzPSJzMSI+J2dpdGh1Yic8L3NwYW4+CiAgPHNwYW4g\\nY2xhc3M9ImsiPmVsaWY8L3NwYW4+IDxzcGFuIGNsYXNzPSJvIj5bPC9zcGFu\\nPiA8c3BhbiBjbGFzcz0iczIiPiI8L3NwYW4+PHNwYW4gY2xhc3M9Im52Ij4k\\nb3JpZ2luX2hvc3RuYW1lPC9zcGFuPjxzcGFuIGNsYXNzPSJzMiI+Ijwvc3Bh\\nbj4gPHNwYW4gY2xhc3M9Im8iPj09PC9zcGFuPiA8c3BhbiBjbGFzcz0iczEi\\nPidiaXRidWNrZXQub3JnJzwvc3Bhbj4gPHNwYW4gY2xhc3M9Im8iPl08L3Nw\\nYW4+PHNwYW4gY2xhc3M9InAiPjs8L3NwYW4+IDxzcGFuIGNsYXNzPSJrIj50\\naGVuPC9zcGFuPgogICAgYWN0aXZhdGVfZHJpdmVyIDxzcGFuIGNsYXNzPSJz\\nMSI+J2NvZGVfaG9zdGluZyc8L3NwYW4+IDxzcGFuIGNsYXNzPSJzMSI+J2Jp\\ndGJ1Y2tldCc8L3NwYW4+CiAgPHNwYW4gY2xhc3M9ImsiPmVsc2U8L3NwYW4+\\nCiAgICBlY2hvX2Vycm9yX2hlYWRlcgogICAgZWNob191c2FnZSA8c3BhbiBj\\nbGFzcz0iczIiPiJVbnN1cHBvcnRlZCBob3N0aW5nIHNlcnZpY2UuIjwvc3Bh\\nbj4KICAgIGVjaG9fdXNhZ2UgPHNwYW4gY2xhc3M9InMxIj4nVGhpcyBjb21t\\nYW5kIHJlcXVpcmVzIGhvc3Rpbmcgb24gR2l0SHViIG9yIEJpdGJ1Y2tldC4n\\nPC9zcGFuPgogICAgZXhpdF93aXRoX2Vycm9yIG5ld2xpbmUKICA8c3BhbiBj\\nbGFzcz0iayI+Zmk8L3NwYW4+CjxzcGFuIGNsYXNzPSJvIj59PC9zcGFuPgo8\\nL3ByZT48L2Rpdj4KPC90ZD48L3RyPjwvdGFibGU+PC9kaXY+PC9kaXY+PC9i\\nb2R5PjwvaHRtbD4KIiIiCgpjbGFzcyBUZXN0SW5kZXhIdG1sKHVuaXR0ZXN0\\nLlRlc3RDYXNlKToKICBAY2xhc3NtZXRob2QKICBkZWYgc2V0VXBDbGFzcyhj\\nbHMpOgogICAgaW5kZXhfaHRtbC5jbGllbnQuY3JlYXRlX3RhYmxlKAogICAg\\nICBBdHRyaWJ1dGVEZWZpbml0aW9ucz1bCiAgICAgICAgewogICAgICAgICAg\\nJ0F0dHJpYnV0ZU5hbWUnOiAnc2hhJywKICAgICAgICAgICdBdHRyaWJ1dGVU\\neXBlJzogJ1MnCiAgICAgICAgfQogICAgICBdLAogICAgICBUYWJsZU5hbWU9\\nJ2dpdHNoYW1lLWNodW5rcycsCiAgICAgIEtleVNjaGVtYT1bCiAgICAgICAg\\newogICAgICAgICAgJ0F0dHJpYnV0ZU5hbWUnOiAnc2hhJywKICAgICAgICAg\\nICdLZXlUeXBlJzogJ0hBU0gnCiAgICAgICAgfQogICAgICBdLAogICAgICBQ\\ncm92aXNpb25lZFRocm91Z2hwdXQ9ewogICAgICAgICdSZWFkQ2FwYWNpdHlV\\nbml0cyc6IDUsCiAgICAgICAgJ1dyaXRlQ2FwYWNpdHlVbml0cyc6IDUKICAg\\nICAgfQogICAgKQoKICAgIGluZGV4X2h0bWwuY2xpZW50LnB1dF9pdGVtKAog\\nICAgICBUYWJsZU5hbWU9J2dpdHNoYW1lLWNodW5rcycsCiAgICAgIEl0ZW09\\newogICAgICAgICdzaGEnOiB7CiAgICAgICAgICAnUyc6ICdpbmRleF9wYWdl\\nJwogICAgICAgIH0sCiAgICAgICAgJ2l0ZW1fc2hhcyc6IHsKICAgICAgICAg\\nICdNJzogewogICAgICAgICAgICAnMSc6IHsKICAgICAgICAgICAgICAnUyc6\\nICc0NDAxYTQ5MjMyNzkxNzYyM2EzMWQ0ODBhOWVhZTIxYTMxYTA4OWVjJwog\\nICAgICAgICAgICB9LAogICAgICAgICAgICAnMic6IHsKICAgICAgICAgICAg\\nICAnUyc6ICc4MDdmNTQzN2E5ZmUyMjFhNmI3OWQ5NjYxOWI0MWM2N2JlMTRj\\nNGY0JwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAg\\nICB9CiAgICApCgogICAgaW5kZXhfaHRtbC5jbGllbnQucHV0X2l0ZW0oCiAg\\nICAgIFRhYmxlTmFtZT0nZ2l0c2hhbWUtY2h1bmtzJywKICAgICAgSXRlbT17\\nCiAgICAgICAgJ3NoYSc6IHsKICAgICAgICAgICdTJzogJzQ0MDFhNDkyMzI3\\nOTE3NjIzYTMxZDQ4MGE5ZWFlMjFhMzFhMDg5ZWMnCiAgICAgICAgfSwKICAg\\nICAgICAnaHRtbCc6IHsKICAgICAgICAgICdTJzogIiIiPHRhYmxlIGNsYXNz\\nPVwiaGlnaGxpZ2h0dGFibGVcIj48dHI+PHRkIGNsYXNzPVwibGluZW5vc1wi\\nPjxkaXYgY2xhc3M9XCJsaW5lbm9kaXZcIj48cHJlPjFcbjI8L3ByZT48L2Rp\\ndj48L3RkPjx0ZCBjbGFzcz1cImNvZGVcIj48ZGl2IGNsYXNzPVwiaGlnaGxp\\nZ2h0XCI+PHByZT48c3Bhbj48L3NwYW4+PHNwYW4gY2xhc3M9XCJudFwiPmgx\\nPC9zcGFuPiA0MDRcbjxzcGFuIGNsYXNzPVwibnRcIj5wPC9zcGFuPiBQYWdl\\nIG5vdCBmb3VuZC4gQnVtbWVyLlxuPC9wcmU+PC9kaXY+XG48L3RkPjwvdHI+\\nPC90YWJsZT4iIiIKICAgICAgICB9LAogICAgICAgICdqc29uJzogewogICAg\\nICAgICAgJ1MnOiAiIiJ7XCJuYW1lXCI6IFwiNDA0LmphZGVcIiwgXCJlbmNv\\nZGluZ1wiOiBcImJhc2U2NFwiLCBcInVybFwiOiBcImh0dHBzOi8vYXBpLmdp\\ndGh1Yi5jb20vcmVwb3MvT3JpZ2luYXRlL2dpdC10b3duL2NvbnRlbnRzL3dl\\nYnNpdGUvNDA0LmphZGU/cmVmPW1hc3RlclwiLCBcImh0bWxfdXJsXCI6IFwi\\naHR0cHM6Ly9naXRodWIuY29tL09yaWdpbmF0ZS9naXQtdG93bi9ibG9iL21h\\nc3Rlci93ZWJzaXRlLzQwNC5qYWRlXCIsIFwiZG93bmxvYWRfdXJsXCI6IFwi\\naHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09yaWdpbmF0ZS9n\\naXQtdG93bi9tYXN0ZXIvd2Vic2l0ZS80MDQuamFkZVwiLCBcImNvbnRlbnRc\\nIjogXCJhREVnTkRBMENuQWdVR0ZuWlNCdWIzUWdabTkxYm1RdUlFSjFiVzFs\\nY2k0S1xcblwiLCBcInNoYVwiOiBcIjQ0MDFhNDkyMzI3OTE3NjIzYTMxZDQ4\\nMGE5ZWFlMjFhMzFhMDg5ZWNcIiwgXCJfbGlua3NcIjoge1wic2VsZlwiOiBc\\nImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvT3JpZ2luYXRlL2dpdC10\\nb3duL2NvbnRlbnRzL3dlYnNpdGUvNDA0LmphZGU/cmVmPW1hc3RlclwiLCBc\\nImdpdFwiOiBcImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvT3JpZ2lu\\nYXRlL2dpdC10b3duL2dpdC9ibG9icy80NDAxYTQ5MjMyNzkxNzYyM2EzMWQ0\\nODBhOWVhZTIxYTMxYTA4OWVjXCIsIFwiaHRtbFwiOiBcImh0dHBzOi8vZ2l0\\naHViLmNvbS9PcmlnaW5hdGUvZ2l0LXRvd24vYmxvYi9tYXN0ZXIvd2Vic2l0\\nZS80MDQuamFkZVwifSwgXCJnaXRfdXJsXCI6IFwiaHR0cHM6Ly9hcGkuZ2l0\\naHViLmNvbS9yZXBvcy9PcmlnaW5hdGUvZ2l0LXRvd24vZ2l0L2Jsb2JzLzQ0\\nMDFhNDkyMzI3OTE3NjIzYTMxZDQ4MGE5ZWFlMjFhMzFhMDg5ZWNcIiwgXCJw\\nYXRoXCI6IFwid2Vic2l0ZS80MDQuamFkZVwiLCBcInR5cGVcIjogXCJmaWxl\\nXCIsIFwic2l6ZVwiOiAzM30iIiIKICAgICAgICB9CiAgICAgIH0KICAgICkK\\nCiAgICBpbmRleF9odG1sLmNsaWVudC5wdXRfaXRlbSgKICAgICAgVGFibGVO\\nYW1lPSdnaXRzaGFtZS1jaHVua3MnLAogICAgICBJdGVtPXsKICAgICAgICAn\\nc2hhJzogewogICAgICAgICAgJ1MnOiAnODA3ZjU0MzdhOWZlMjIxYTZiNzlk\\nOTY2MTliNDFjNjdiZTE0YzRmNCcKICAgICAgICB9LAogICAgICAgICdodG1s\\nJzogewogICAgICAgICAgJ1MnOiAiIiI8dGFibGUgY2xhc3M9XCJoaWdobGln\\naHR0YWJsZVwiPjx0cj48dGQgY2xhc3M9XCJsaW5lbm9zXCI+PGRpdiBjbGFz\\ncz1cImxpbmVub2RpdlwiPjxwcmU+IDFcbiAyXG4gM1xuIDRcbiA1XG4gNlxu\\nIDdcbiA4XG4gOVxuMTBcbjExXG4xMlxuMTNcbjE0XG4xNVxuMTZcbjE3XG4x\\nOFxuMTlcbjIwXG4yMVxuMjJcbjIzPC9wcmU+PC9kaXY+PC90ZD48dGQgY2xh\\nc3M9XCJjb2RlXCI+PGRpdiBjbGFzcz1cImhpZ2hsaWdodFwiPjxwcmU+PHNw\\nYW4+PC9zcGFuPjxzcGFuIGNsYXNzPVwiY2hcIj4jIS91c3IvYmluL2VudiBi\\nYXNoPC9zcGFuPlxuXG48c3BhbiBjbGFzcz1cImMxXCI+IyBUaGlzIGlzIHRo\\nZSBhY3RpdmF0aW9uIHNjcmlwdCBmb3IgdGhlIFwiY29kZSBob3N0aW5nXCIg\\nZHJpdmVyIGZhbWlseS48L3NwYW4+XG48c3BhbiBjbGFzcz1cImMxXCI+Izwv\\nc3Bhbj5cbjxzcGFuIGNsYXNzPVwiYzFcIj4jIEl0IGlzIGNhbGxlZCB3aGVu\\nIHRoaXMgZmFtaWx5IGlzIGFjdGl2YXRlZC48L3NwYW4+XG48c3BhbiBjbGFz\\ncz1cImMxXCI+IyBJdCBhdXRvbWF0aWNhbGx5IGRldGVybWluZXMgdGhlIHJp\\nZ2h0IGRyaXZlciBmb3IgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQ8L3NwYW4+\\nXG48c3BhbiBjbGFzcz1cImMxXCI+IyBhbmQgbG9hZHMgaXQuPC9zcGFuPlxu\\nXG5cbjxzcGFuIGNsYXNzPVwiYzFcIj4jIExvYWRzIHRoZSBjb2RlLWhvc3Rp\\nbmcgZHJpdmVyIHRoYXQgd29ya3Mgd2l0aCB0aGUgZ2l2ZW4gaG9zdG5hbWU8\\nL3NwYW4+XG48c3BhbiBjbGFzcz1cImtcIj5mdW5jdGlvbjwvc3Bhbj4gYWN0\\naXZhdGVfZHJpdmVyX2Zvcl9jb2RlX2hvc3RpbmcgPHNwYW4gY2xhc3M9XCJv\\nXCI+ezwvc3Bhbj5cbiAgPHNwYW4gY2xhc3M9XCJuYlwiPmxvY2FsPC9zcGFu\\nPiA8c3BhbiBjbGFzcz1cIm52XCI+b3JpZ2luX2hvc3RuYW1lPC9zcGFuPjxz\\ncGFuIGNsYXNzPVwib1wiPj08L3NwYW4+PHNwYW4gY2xhc3M9XCJzMlwiPlwi\\nPC9zcGFuPjxzcGFuIGNsYXNzPVwia1wiPiQoPC9zcGFuPnJlbW90ZV9kb21h\\naW48c3BhbiBjbGFzcz1cImtcIj4pPC9zcGFuPjxzcGFuIGNsYXNzPVwiczJc\\nIj5cIjwvc3Bhbj5cbiAgPHNwYW4gY2xhc3M9XCJrXCI+aWY8L3NwYW4+IDxz\\ncGFuIGNsYXNzPVwib1wiPls8L3NwYW4+IDxzcGFuIGNsYXNzPVwiczJcIj5c\\nIjwvc3Bhbj48c3BhbiBjbGFzcz1cIm52XCI+JG9yaWdpbl9ob3N0bmFtZTwv\\nc3Bhbj48c3BhbiBjbGFzcz1cInMyXCI+XCI8L3NwYW4+IDxzcGFuIGNsYXNz\\nPVwib1wiPj09PC9zcGFuPiA8c3BhbiBjbGFzcz1cInMxXCI+J2dpdGh1Yi5j\\nb20nPC9zcGFuPiA8c3BhbiBjbGFzcz1cIm9cIj5dPC9zcGFuPjxzcGFuIGNs\\nYXNzPVwicFwiPjs8L3NwYW4+IDxzcGFuIGNsYXNzPVwia1wiPnRoZW48L3Nw\\nYW4+XG4gICAgYWN0aXZhdGVfZHJpdmVyIDxzcGFuIGNsYXNzPVwiczFcIj4n\\nY29kZV9ob3N0aW5nJzwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJzMVwiPidnaXRo\\ndWInPC9zcGFuPlxuICA8c3BhbiBjbGFzcz1cImtcIj5lbGlmPC9zcGFuPiA8\\nc3BhbiBjbGFzcz1cIm9cIj5bPC9zcGFuPiA8c3BhbiBjbGFzcz1cInMyXCI+\\nXCI8L3NwYW4+PHNwYW4gY2xhc3M9XCJudlwiPiRvcmlnaW5faG9zdG5hbWU8\\nL3NwYW4+PHNwYW4gY2xhc3M9XCJzMlwiPlwiPC9zcGFuPiA8c3BhbiBjbGFz\\ncz1cIm9cIj49PTwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJzMVwiPidiaXRidWNr\\nZXQub3JnJzwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJvXCI+XTwvc3Bhbj48c3Bh\\nbiBjbGFzcz1cInBcIj47PC9zcGFuPiA8c3BhbiBjbGFzcz1cImtcIj50aGVu\\nPC9zcGFuPlxuICAgIGFjdGl2YXRlX2RyaXZlciA8c3BhbiBjbGFzcz1cInMx\\nXCI+J2NvZGVfaG9zdGluZyc8L3NwYW4+IDxzcGFuIGNsYXNzPVwiczFcIj4n\\nYml0YnVja2V0Jzwvc3Bhbj5cbiAgPHNwYW4gY2xhc3M9XCJrXCI+ZWxzZTwv\\nc3Bhbj5cbiAgICBlY2hvX2Vycm9yX2hlYWRlclxuICAgIGVjaG9fdXNhZ2Ug\\nPHNwYW4gY2xhc3M9XCJzMlwiPlwiVW5zdXBwb3J0ZWQgaG9zdGluZyBzZXJ2\\naWNlLlwiPC9zcGFuPlxuICAgIGVjaG9fdXNhZ2UgPHNwYW4gY2xhc3M9XCJz\\nMVwiPidUaGlzIGNvbW1hbmQgcmVxdWlyZXMgaG9zdGluZyBvbiBHaXRIdWIg\\nb3IgQml0YnVja2V0Lic8L3NwYW4+XG4gICAgZXhpdF93aXRoX2Vycm9yIG5l\\nd2xpbmVcbiAgPHNwYW4gY2xhc3M9XCJrXCI+Zmk8L3NwYW4+XG48c3BhbiBj\\nbGFzcz1cIm9cIj59PC9zcGFuPlxuPC9wcmU+PC9kaXY+XG48L3RkPjwvdHI+\\nPC90YWJsZT4iIiIKICAgICAgICB9LAogICAgICAgICdqc29uJzogewogICAg\\nICAgICAgJ1MnOiAiIiJ7XCJuYW1lXCI6IFwiYWN0aXZhdGUuc2hcIiwgXCJl\\nbmNvZGluZ1wiOiBcImJhc2U2NFwiLCBcInVybFwiOiBcImh0dHBzOi8vYXBp\\nLmdpdGh1Yi5jb20vcmVwb3MvT3JpZ2luYXRlL2dpdC10b3duL2NvbnRlbnRz\\nL3NyYy9kcml2ZXJzL2NvZGVfaG9zdGluZy9hY3RpdmF0ZS5zaD9yZWY9bWFz\\ndGVyXCIsIFwiaHRtbF91cmxcIjogXCJodHRwczovL2dpdGh1Yi5jb20vT3Jp\\nZ2luYXRlL2dpdC10b3duL2Jsb2IvbWFzdGVyL3NyYy9kcml2ZXJzL2NvZGVf\\naG9zdGluZy9hY3RpdmF0ZS5zaFwiLCBcImRvd25sb2FkX3VybFwiOiBcImh0\\ndHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9PcmlnaW5hdGUvZ2l0\\nLXRvd24vbWFzdGVyL3NyYy9kcml2ZXJzL2NvZGVfaG9zdGluZy9hY3RpdmF0\\nZS5zaFwiLCBcImNvbnRlbnRcIjogXCJJeUV2ZFhOeUwySnBiaTlsYm5ZZ1lt\\nRnphQW9LSXlCVWFHbHpJR2x6SUhSb1pTQmhZM1JwZG1GMGFXOXVcXG5JSE5q\\nY21sd2RDQm1iM0lnZEdobElDSmpiMlJsSUdodmMzUnBibWNpSUdSeWFYWmxj\\naUJtWVcxcGJIa3VcXG5DaU1LSXlCSmRDQnBjeUJqWVd4c1pXUWdkMmhsYmlC\\nMGFHbHpJR1poYldsc2VTQnBjeUJoWTNScGRtRjBcXG5aV1F1Q2lNZ1NYUWdZ\\nWFYwYjIxaGRHbGpZV3hzZVNCa1pYUmxjbTFwYm1WeklIUm9aU0J5YVdkb2RD\\nQmtcXG5jbWwyWlhJZ1ptOXlJSFJvWlNCamRYSnlaVzUwSUdWdWRtbHliMjV0\\nWlc1MENpTWdZVzVrSUd4dllXUnpcXG5JR2wwTGdvS0NpTWdURzloWkhNZ2RH\\naGxJR052WkdVdGFHOXpkR2x1WnlCa2NtbDJaWElnZEdoaGRDQjNcXG5iM0py\\nY3lCM2FYUm9JSFJvWlNCbmFYWmxiaUJvYjNOMGJtRnRaUXBtZFc1amRHbHZi\\naUJoWTNScGRtRjBcXG5aVjlrY21sMlpYSmZabTl5WDJOdlpHVmZhRzl6ZEds\\ndVp5QjdDaUFnYkc5allXd2diM0pwWjJsdVgyaHZcXG5jM1J1WVcxbFBTSWtL\\nSEpsYlc5MFpWOWtiMjFoYVc0cElnb2dJR2xtSUZzZ0lpUnZjbWxuYVc1ZmFH\\nOXpcXG5kRzVoYldVaUlEMDlJQ2RuYVhSb2RXSXVZMjl0SnlCZE95QjBhR1Z1\\nQ2lBZ0lDQmhZM1JwZG1GMFpWOWtcXG5jbWwyWlhJZ0oyTnZaR1ZmYUc5emRH\\nbHVaeWNnSjJkcGRHaDFZaWNLSUNCbGJHbG1JRnNnSWlSdmNtbG5cXG5hVzVm\\nYUc5emRHNWhiV1VpSUQwOUlDZGlhWFJpZFdOclpYUXViM0puSnlCZE95QjBh\\nR1Z1Q2lBZ0lDQmhcXG5ZM1JwZG1GMFpWOWtjbWwyWlhJZ0oyTnZaR1ZmYUc5\\nemRHbHVaeWNnSjJKcGRHSjFZMnRsZENjS0lDQmxcXG5iSE5sQ2lBZ0lDQmxZ\\nMmh2WDJWeWNtOXlYMmhsWVdSbGNnb2dJQ0FnWldOb2IxOTFjMkZuWlNBaVZX\\nNXpcXG5kWEJ3YjNKMFpXUWdhRzl6ZEdsdVp5QnpaWEoyYVdObExpSUtJQ0Fn\\nSUdWamFHOWZkWE5oWjJVZ0oxUm9cXG5hWE1nWTI5dGJXRnVaQ0J5WlhGMWFY\\nSmxjeUJvYjNOMGFXNW5JRzl1SUVkcGRFaDFZaUJ2Y2lCQ2FYUmlcXG5kV05y\\nWlhRdUp3b2dJQ0FnWlhocGRGOTNhWFJvWDJWeWNtOXlJRzVsZDJ4cGJtVUtJ\\nQ0JtYVFwOUNnPT1cXG5cIiwgXCJzaGFcIjogXCI4MDdmNTQzN2E5ZmUyMjFh\\nNmI3OWQ5NjYxOWI0MWM2N2JlMTRjNGY0XCIsIFwiX2xpbmtzXCI6IHtcInNl\\nbGZcIjogXCJodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL09yaWdpbmF0\\nZS9naXQtdG93bi9jb250ZW50cy9zcmMvZHJpdmVycy9jb2RlX2hvc3Rpbmcv\\nYWN0aXZhdGUuc2g/cmVmPW1hc3RlclwiLCBcImdpdFwiOiBcImh0dHBzOi8v\\nYXBpLmdpdGh1Yi5jb20vcmVwb3MvT3JpZ2luYXRlL2dpdC10b3duL2dpdC9i\\nbG9icy84MDdmNTQzN2E5ZmUyMjFhNmI3OWQ5NjYxOWI0MWM2N2JlMTRjNGY0\\nXCIsIFwiaHRtbFwiOiBcImh0dHBzOi8vZ2l0aHViLmNvbS9PcmlnaW5hdGUv\\nZ2l0LXRvd24vYmxvYi9tYXN0ZXIvc3JjL2RyaXZlcnMvY29kZV9ob3N0aW5n\\nL2FjdGl2YXRlLnNoXCJ9LCBcImdpdF91cmxcIjogXCJodHRwczovL2FwaS5n\\naXRodWIuY29tL3JlcG9zL09yaWdpbmF0ZS9naXQtdG93bi9naXQvYmxvYnMv\\nODA3ZjU0MzdhOWZlMjIxYTZiNzlkOTY2MTliNDFjNjdiZTE0YzRmNFwiLCBc\\nInBhdGhcIjogXCJzcmMvZHJpdmVycy9jb2RlX2hvc3RpbmcvYWN0aXZhdGUu\\nc2hcIiwgXCJ0eXBlXCI6IFwiZmlsZVwiLCBcInNpemVcIjogNzYzfSIiIgog\\nICAgICAgIH0KICAgICAgfQogICAgKQoKICBAY2xhc3NtZXRob2QKICBkZWYg\\ndGVhckRvd25DbGFzcyhjbHMpOgogICAgaW5kZXhfaHRtbC5jbGllbnQuZGVs\\nZXRlX3RhYmxlKFRhYmxlTmFtZT0nZ2l0c2hhbWUtY2h1bmtzJykKCiAgZGVm\\nIHRlc3RfaW5kZXhfaHRtbChzZWxmKToKICAgIHNlbGYuYXNzZXJ0RXF1YWwo\\naW5kZXhfaHRtbC5oYW5kbGVyKCcnLCcnKS5zdHJpcCgpLCBleHBlY3RlZC5z\\ndHJpcCgpKQoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICB1bml0dGVz\\ndC5tYWluKCkK\\n", "sha": "e9ee37bc9174fef1e16773bee135577de83e5b18", "_links": {"self": "https://api.github.com/repos/dminnear/gitshame/contents/lambdas/index_html/index_html_test.py?ref=ca25824abb09c1e709daecdbc23f559b261acdb6", "git": "https://api.github.com/repos/dminnear/gitshame/git/blobs/e9ee37bc9174fef1e16773bee135577de83e5b18", "html": "https://github.com/dminnear/gitshame/blob/ca25824abb09c1e709daecdbc23f559b261acdb6/lambdas/index_html/index_html_test.py"}, "git_url": "https://api.github.com/repos/dminnear/gitshame/git/blobs/e9ee37bc9174fef1e16773bee135577de83e5b18", "path": "lambdas/index_html/index_html_test.py", "type": "file", "size": 10764}'
}

test_link_3 = {
  'link': 'https://github.com/dminnear/gitshame/blob/aed5478cd309ac2e751f65b95d77f3ae5f8d3032/scripts/html-deploy',
  'sha': 'cd52ac407623634ee940cfdcbe856fadfa0a6968',
  'html': '<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>\n\n<span class="nb">set</span> -ex\n\n<span class="nv">FILE</span><span class="o">=</span><span class="nv">$1</span>\n\n<span class="c1"># Find last successful commit to master</span>\n<span class="nv">CURL</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;https://circleci.com/api/v1/project/dminnear/gitshame/tree/master&quot;</span><span class="k">)</span>\n<span class="nv">COUNTER</span><span class="o">=</span>0\n<span class="k">while</span> jq <span class="s2">&quot;.[</span><span class="nv">$COUNTER</span><span class="s2">].outcome&quot;</span> <span class="o">&lt;&lt;&lt;</span> <span class="nv">$CURL</span> <span class="p">|</span>  grep -qv success<span class="p">;</span> <span class="k">do</span>\n  <span class="o">((</span>COUNTER++<span class="o">))</span>\n<span class="k">done</span>\n<span class="nv">COMMIT</span><span class="o">=</span><span class="k">$(</span><span class="s2">&quot;</span><span class="nv">$CURL</span><span class="s2">&quot;</span> <span class="p">|</span> jq <span class="s2">&quot;.[COUNTER].vcs_revision&quot;</span><span class="k">)</span>\n\n<span class="k">if</span> git diff --name-only <span class="s2">&quot;</span><span class="nv">$COMMIT</span><span class="s2">&quot;</span> <span class="p">|</span> grep -q html/<span class="s2">&quot;</span><span class="nv">$FILE</span><span class="s2">&quot;</span> <span class="o">||</span> git ls-files --others --exclude-standard <span class="p">|</span> grep -q html/<span class="s2">&quot;</span><span class="nv">$FILE</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">then</span>\n  <span class="nb">cd</span> html/\n\n  aws s3 cp <span class="s2">&quot;</span><span class="nv">$FILE</span><span class="s2">&quot;</span> s3://gitshame-html/<span class="s2">&quot;</span><span class="nv">$FILE</span><span class="s2">&quot;</span>\n<span class="k">fi</span>\n</pre></div>\n</td></tr></table>',
  'json': '{"name": "html-deploy", "encoding": "base64", "url": "https://api.github.com/repos/dminnear/gitshame/contents/scripts/html-deploy?ref=aed5478cd309ac2e751f65b95d77f3ae5f8d3032", "html_url": "https://github.com/dminnear/gitshame/blob/aed5478cd309ac2e751f65b95d77f3ae5f8d3032/scripts/html-deploy", "download_url": "https://raw.githubusercontent.com/dminnear/gitshame/aed5478cd309ac2e751f65b95d77f3ae5f8d3032/scripts/html-deploy", "content": "IyEvdXNyL2Jpbi9lbnYgYmFzaAoKc2V0IC1leAoKRklMRT0kMQoKIyBGaW5k\\nIGxhc3Qgc3VjY2Vzc2Z1bCBjb21taXQgdG8gbWFzdGVyCkNVUkw9JChjdXJs\\nICJodHRwczovL2NpcmNsZWNpLmNvbS9hcGkvdjEvcHJvamVjdC9kbWlubmVh\\nci9naXRzaGFtZS90cmVlL21hc3RlciIpCkNPVU5URVI9MAp3aGlsZSBqcSAi\\nLlskQ09VTlRFUl0ub3V0Y29tZSIgPDw8ICRDVVJMIHwgIGdyZXAgLXF2IHN1\\nY2Nlc3M7IGRvCiAgKChDT1VOVEVSKyspKQpkb25lCkNPTU1JVD0kKCIkQ1VS\\nTCIgfCBqcSAiLltDT1VOVEVSXS52Y3NfcmV2aXNpb24iKQoKaWYgZ2l0IGRp\\nZmYgLS1uYW1lLW9ubHkgIiRDT01NSVQiIHwgZ3JlcCAtcSBodG1sLyIkRklM\\nRSIgfHwgZ2l0IGxzLWZpbGVzIC0tb3RoZXJzIC0tZXhjbHVkZS1zdGFuZGFy\\nZCB8IGdyZXAgLXEgaHRtbC8iJEZJTEUiOyB0aGVuCiAgY2QgaHRtbC8KCiAg\\nYXdzIHMzIGNwICIkRklMRSIgczM6Ly9naXRzaGFtZS1odG1sLyIkRklMRSIK\\nZmkK\\n", "sha": "cd52ac407623634ee940cfdcbe856fadfa0a6968", "_links": {"self": "https://api.github.com/repos/dminnear/gitshame/contents/scripts/html-deploy?ref=aed5478cd309ac2e751f65b95d77f3ae5f8d3032", "git": "https://api.github.com/repos/dminnear/gitshame/git/blobs/cd52ac407623634ee940cfdcbe856fadfa0a6968", "html": "https://github.com/dminnear/gitshame/blob/aed5478cd309ac2e751f65b95d77f3ae5f8d3032/scripts/html-deploy"}, "git_url": "https://api.github.com/repos/dminnear/gitshame/git/blobs/cd52ac407623634ee940cfdcbe856fadfa0a6968", "path": "scripts/html-deploy", "type": "file", "size": 498}'
}

class TestPygmentize(unittest.TestCase):
  @classmethod
  def setUpClass(cls):
    pygmentize.client.create_table(
      AttributeDefinitions=[
        {
          'AttributeName': 'sha',
          'AttributeType': 'S'
        }
      ],
      TableName='gitshame-chunks',
      KeySchema=[
        {
          'AttributeName': 'sha',
          'KeyType': 'HASH'
        }
      ],
      ProvisionedThroughput={
        'ReadCapacityUnits': 5,
        'WriteCapacityUnits': 5
      }
    )

    pygmentize.client.put_item(
      TableName='gitshame-chunks',
      Item={
        'sha': {
          'S': 'index_page'
        },
        'item_shas': {
          'M': {
            '1': {
              'S': '4401a492327917623a31d480a9eae21a31a089ec'
            },
            '2': {
              'S': '807f5437a9fe221a6b79d96619b41c67be14c4f4'
            },
            '3': {
              'S': '4401a492327917623a31d480a9eae21a31a089ec'
            },
            '4': {
              'S': '807f5437a9fe221a6b79d96619b41c67be14c4f4'
            }
          }
        }
      }
    )

    pygmentize.client.put_item(
      TableName='gitshame-chunks',
      Item={
        'sha': {
          'S': '4401a492327917623a31d480a9eae21a31a089ec'
        },
        'html': {
          'S': """<table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre>1\n2</pre></div></td><td class=\"code\"><div class=\"highlight\"><pre><span></span><span class=\"nt\">h1</span> 404\n<span class=\"nt\">p</span> Page not found. Bummer.\n</pre></div>\n</td></tr></table>"""
        },
        'json': {
          'S': """{\"name\": \"404.jade\", \"encoding\": \"base64\", \"url\": \"https://api.github.com/repos/Originate/git-town/contents/website/404.jade?ref=master\", \"html_url\": \"https://github.com/Originate/git-town/blob/master/website/404.jade\", \"download_url\": \"https://raw.githubusercontent.com/Originate/git-town/master/website/404.jade\", \"content\": \"aDEgNDA0CnAgUGFnZSBub3QgZm91bmQuIEJ1bW1lci4K\\n\", \"sha\": \"4401a492327917623a31d480a9eae21a31a089ec\", \"_links\": {\"self\": \"https://api.github.com/repos/Originate/git-town/contents/website/404.jade?ref=master\", \"git\": \"https://api.github.com/repos/Originate/git-town/git/blobs/4401a492327917623a31d480a9eae21a31a089ec\", \"html\": \"https://github.com/Originate/git-town/blob/master/website/404.jade\"}, \"git_url\": \"https://api.github.com/repos/Originate/git-town/git/blobs/4401a492327917623a31d480a9eae21a31a089ec\", \"path\": \"website/404.jade\", \"type\": \"file\", \"size\": 33}"""
        }
      }
    )

    pygmentize.client.put_item(
      TableName='gitshame-chunks',
      Item={
        'sha': {
          'S': '807f5437a9fe221a6b79d96619b41c67be14c4f4'
        },
        'html': {
          'S': """<table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23</pre></div></td><td class=\"code\"><div class=\"highlight\"><pre><span></span><span class=\"ch\">#!/usr/bin/env bash</span>\n\n<span class=\"c1\"># This is the activation script for the \"code hosting\" driver family.</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># It is called when this family is activated.</span>\n<span class=\"c1\"># It automatically determines the right driver for the current environment</span>\n<span class=\"c1\"># and loads it.</span>\n\n\n<span class=\"c1\"># Loads the code-hosting driver that works with the given hostname</span>\n<span class=\"k\">function</span> activate_driver_for_code_hosting <span class=\"o\">{</span>\n  <span class=\"nb\">local</span> <span class=\"nv\">origin_hostname</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"k\">$(</span>remote_domain<span class=\"k\">)</span><span class=\"s2\">\"</span>\n  <span class=\"k\">if</span> <span class=\"o\">[</span> <span class=\"s2\">\"</span><span class=\"nv\">$origin_hostname</span><span class=\"s2\">\"</span> <span class=\"o\">==</span> <span class=\"s1\">'github.com'</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n    activate_driver <span class=\"s1\">'code_hosting'</span> <span class=\"s1\">'github'</span>\n  <span class=\"k\">elif</span> <span class=\"o\">[</span> <span class=\"s2\">\"</span><span class=\"nv\">$origin_hostname</span><span class=\"s2\">\"</span> <span class=\"o\">==</span> <span class=\"s1\">'bitbucket.org'</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n    activate_driver <span class=\"s1\">'code_hosting'</span> <span class=\"s1\">'bitbucket'</span>\n  <span class=\"k\">else</span>\n    echo_error_header\n    echo_usage <span class=\"s2\">\"Unsupported hosting service.\"</span>\n    echo_usage <span class=\"s1\">'This command requires hosting on GitHub or Bitbucket.'</span>\n    exit_with_error newline\n  <span class=\"k\">fi</span>\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></table>"""
        },
        'json': {
          'S': """{\"name\": \"activate.sh\", \"encoding\": \"base64\", \"url\": \"https://api.github.com/repos/Originate/git-town/contents/src/drivers/code_hosting/activate.sh?ref=master\", \"html_url\": \"https://github.com/Originate/git-town/blob/master/src/drivers/code_hosting/activate.sh\", \"download_url\": \"https://raw.githubusercontent.com/Originate/git-town/master/src/drivers/code_hosting/activate.sh\", \"content\": \"IyEvdXNyL2Jpbi9lbnYgYmFzaAoKIyBUaGlzIGlzIHRoZSBhY3RpdmF0aW9u\\nIHNjcmlwdCBmb3IgdGhlICJjb2RlIGhvc3RpbmciIGRyaXZlciBmYW1pbHku\\nCiMKIyBJdCBpcyBjYWxsZWQgd2hlbiB0aGlzIGZhbWlseSBpcyBhY3RpdmF0\\nZWQuCiMgSXQgYXV0b21hdGljYWxseSBkZXRlcm1pbmVzIHRoZSByaWdodCBk\\ncml2ZXIgZm9yIHRoZSBjdXJyZW50IGVudmlyb25tZW50CiMgYW5kIGxvYWRz\\nIGl0LgoKCiMgTG9hZHMgdGhlIGNvZGUtaG9zdGluZyBkcml2ZXIgdGhhdCB3\\nb3JrcyB3aXRoIHRoZSBnaXZlbiBob3N0bmFtZQpmdW5jdGlvbiBhY3RpdmF0\\nZV9kcml2ZXJfZm9yX2NvZGVfaG9zdGluZyB7CiAgbG9jYWwgb3JpZ2luX2hv\\nc3RuYW1lPSIkKHJlbW90ZV9kb21haW4pIgogIGlmIFsgIiRvcmlnaW5faG9z\\ndG5hbWUiID09ICdnaXRodWIuY29tJyBdOyB0aGVuCiAgICBhY3RpdmF0ZV9k\\ncml2ZXIgJ2NvZGVfaG9zdGluZycgJ2dpdGh1YicKICBlbGlmIFsgIiRvcmln\\naW5faG9zdG5hbWUiID09ICdiaXRidWNrZXQub3JnJyBdOyB0aGVuCiAgICBh\\nY3RpdmF0ZV9kcml2ZXIgJ2NvZGVfaG9zdGluZycgJ2JpdGJ1Y2tldCcKICBl\\nbHNlCiAgICBlY2hvX2Vycm9yX2hlYWRlcgogICAgZWNob191c2FnZSAiVW5z\\ndXBwb3J0ZWQgaG9zdGluZyBzZXJ2aWNlLiIKICAgIGVjaG9fdXNhZ2UgJ1Ro\\naXMgY29tbWFuZCByZXF1aXJlcyBob3N0aW5nIG9uIEdpdEh1YiBvciBCaXRi\\ndWNrZXQuJwogICAgZXhpdF93aXRoX2Vycm9yIG5ld2xpbmUKICBmaQp9Cg==\\n\", \"sha\": \"807f5437a9fe221a6b79d96619b41c67be14c4f4\", \"_links\": {\"self\": \"https://api.github.com/repos/Originate/git-town/contents/src/drivers/code_hosting/activate.sh?ref=master\", \"git\": \"https://api.github.com/repos/Originate/git-town/git/blobs/807f5437a9fe221a6b79d96619b41c67be14c4f4\", \"html\": \"https://github.com/Originate/git-town/blob/master/src/drivers/code_hosting/activate.sh\"}, \"git_url\": \"https://api.github.com/repos/Originate/git-town/git/blobs/807f5437a9fe221a6b79d96619b41c67be14c4f4\", \"path\": \"src/drivers/code_hosting/activate.sh\", \"type\": \"file\", \"size\": 763}"""
        }
      }
    )

  @classmethod
  def tearDownClass(cls):
    pygmentize.client.delete_table(TableName='gitshame-chunks')

  def test_pygmentize(self):
    sha, html, json = pygmentize.handler({'github_link': test_link_1['link']}, '')
    self.assertEqual(sha, test_link_1['sha'])
    self.assertEqual(html, test_link_1['html'])
    self.assertEqual(json, test_link_1['json'])

    sha, html, json = pygmentize.handler({'github_link': test_link_2['link']}, '')
    self.assertEqual(sha, test_link_2['sha'])
    self.assertEqual(html, test_link_2['html'])
    self.assertEqual(json, test_link_2['json'])

    sha, html, json = pygmentize.handler({'github_link': test_link_3['link']}, '')
    self.assertEqual(sha, test_link_3['sha'])
    self.assertEqual(html, test_link_3['html'])
    self.assertEqual(json, test_link_3['json'])



if __name__ == '__main__':
  unittest.main()
