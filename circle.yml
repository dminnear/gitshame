dependencies:
  cache_directories:
    - ~/nvm

  override:
    - sudo pip install boto3
    - npm install -g dynalite

test:
  pre:
    - dynalite --port 8001 --createTableMs 0 --deleteTableMs 0 --updateTableMs 0:
        background: true

  override:
    - python lambdas/index_html/index_html_test.py
    - python lambdas/post_comment/post_comment_test.py

deployment:
  master:
    branch: master
    commands:
      - ./scripts/lambda-deploy index_html index-html
      - ./scripts/lambda-deploy pygmentize pygmentize
      - ./scripts/lambda-deploy sha-page sha-page
      - ./scripts/lambda-deploy post_comment post-comment
      - ./scripts/html-deploy main.css
      - ./scripts/html-deploy main.js
      - ./scripts/html-deploy icon.png
